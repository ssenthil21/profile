<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QTick</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
      :root {
          --brand-charcoal:#36322F;
          --brand-accent:#C08261;
          --brand-light:#F5EFE6;
      }
      body{
          font-family: 'Poppins', sans-serif;
          color: var(--brand-charcoal);
      }
      h1,h2,h3,h4,h5,h6{
          font-family:'DM Sans', sans-serif;
      }
      @keyframes fadeInUp {
          from {
              opacity: 0;
              transform: translateY(20px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }
      .category-card {
          opacity: 0;
          animation: fadeInUp 0.6s ease forwards;
          animation-delay: var(--delay);
      }
      .category-card.compact {
          padding: 1rem;
          flex-direction: row;
          width: 100%;
          justify-content: flex-start;
      }
      .category-card.compact .w-16 {
          width: 2.5rem;
          height: 2.5rem;
          margin-bottom: 0;
          margin-right: 0.5rem;
      }
      .result-card {
          opacity: 0;
          transform: translateY(20px);
          transition: opacity 0.3s ease, transform 0.3s ease;
      }
      .result-card.show {
          opacity: 1;
          transform: translateY(0);
      }

      @keyframes starGlow {
          0%,100% { text-shadow: 0 0 2px #FBBF24; }
          50% { text-shadow: 0 0 8px #FBBF24; }
      }
      .star-glow { animation: starGlow 1.5s ease-in-out infinite; }
  </style>
</head>
<body class="bg-white">
  <header class="bg-white shadow-sm">
      <div class="max-w-6xl mx-auto flex items-center justify-between p-4">
        <a id="homeLogo" href="#" class="flex items-center">
          <img src="logo.svg" alt="QTick logo" class="h-8 w-auto mr-2" />
          <span class="text-2xl font-bold text-[var(--brand-accent)]">QTick</span>
        </a>
        <nav class="space-x-4">
          <a href="#" class="text-gray-600 hover:text-[var(--brand-accent)]">Home</a>
          <a href="#categories" class="text-gray-600 hover:text-[var(--brand-accent)]">Categories</a>
        </nav>
      </div>
    </header>

  <section id="explore" class="max-w-6xl mx-auto py-16">
    <div id="categories">
      <div class="flex items-center justify-center lg:justify-start mb-8 space-x-4">
        <span class="flex items-center text-gray-600"><i class="fa-solid fa-location-dot mr-1"></i>Chenai</span>
        <input id="categorySearch" type="text" placeholder="Search categories..." class="border border-gray-300 rounded-md px-3 py-2 w-64"/>
        <button id="globalMapToggle" class="px-4 py-2 border rounded-md">Map View</button>
      </div>
      <h3 class="text-3xl font-bold text-center mb-10 lg:text-left">Popular categories</h3>
      <div id="categoryGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
      <button style="--delay:0s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="salon">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-scissors text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Salon</span>
      </button>
      <button style="--delay:0.1s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="spa">
      <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-spa text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Spa</span>
      </button>
      <button style="--delay:0.2s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="parlour">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-hand-sparkles text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Parlours</span>
      </button>
      <button style="--delay:0.3s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="clinic">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-clinic-medical text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Clinic</span>
      </button>
      <button style="--delay:0.4s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="food">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-burger text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Food Take Away</span>
      </button>
      <button style="--delay:0.5s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="laundry">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-shirt text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Laundry</span>
      </button>
      <button style="--delay:0.6s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="turf">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-golf-ball-tee text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Turf Club</span>
      </button>
      <button style="--delay:0.7s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="gamezone">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-gamepad text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Gamezone</span>
      </button>
      <button style="--delay:0.8s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="massage">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-hand-holding-heart text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Massage</span>
      </button>
      <button style="--delay:0.9s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="event">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-calendar-check text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Event Management</span>
      </button>
      <button style="--delay:1s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="petclinic">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-paw text-3xl"></i>
        </div>
      <span class="text-lg font-semibold">Pet Clinic</span>
      </button>
      <button style="--delay:1.1s" class="category-card group relative p-8 rounded-xl bg-gradient-to-br from-white to-[var(--brand-light)] border border-[var(--brand-accent)] shadow-md hover:shadow-2xl hover:-translate-y-1 hover:scale-105 transform transition-all flex flex-col items-center text-center overflow-hidden" data-category="dressiron">
        <span class="absolute inset-0 bg-[var(--brand-accent)] opacity-0 group-hover:opacity-10 transition-opacity"></span>
        <div class="w-16 h-16 flex items-center justify-center rounded-full bg-[var(--brand-accent)] text-white mb-4 transition-transform group-hover:scale-110">
          <i class="fa-solid fa-shirt text-3xl"></i>
        </div>
        <span class="text-lg font-semibold">Dress Iron</span>
      </button>
      </div>
      <div id="globalMapContainer" class="hidden h-96 mb-8 w-full"></div>
    </div>
    <div id="results" class="hidden mt-16 lg:mt-0 lg:pl-12 results-section">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-3xl font-bold">Results</h3>
        <button id="mapToggle" class="hidden px-4 py-2 border rounded-md">Map View</button>
      </div>
      <div id="mapContainer" class="hidden h-96 mb-8 w-full"></div>
      <div id="resultsContainer" class="grid gap-8 sm:grid-cols-2 lg:grid-cols-2"></div>
    </div>
  </section>
  <div id="ratingPanel" class="fixed top-0 right-0 w-80 h-full bg-white shadow-lg overflow-y-auto transform translate-x-full transition-transform z-50">
    <div class="flex justify-between items-center p-4 border-b">
      <h3 class="text-lg font-semibold">Ratings</h3>
      <button id="ratingPanelClose" class="text-2xl leading-none">&times;</button>
    </div>
    <div id="ratingPanelContent" class="p-4 space-y-4"></div>
  </div>
  <script>
    let businesses = [];
    const results = document.getElementById("results");
    const resultsContainer = document.getElementById("resultsContainer");
    const categoryGrid = document.getElementById("categoryGrid");
    const categoriesSection = document.getElementById("categories");
    const explore = document.getElementById("explore");
    const globalMapToggle = document.getElementById("globalMapToggle");
    const globalMapContainer = document.getElementById("globalMapContainer");
    const searchInput = document.getElementById("categorySearch");
    const mapToggle = document.getElementById("mapToggle");
    const mapContainer = document.getElementById("mapContainer");
    const ratingPanel = document.getElementById("ratingPanel");
    const ratingPanelContent = document.getElementById("ratingPanelContent");
    const ratingPanelClose = document.getElementById("ratingPanelClose");
    ratingPanelClose.addEventListener("click", () => ratingPanel.classList.add("translate-x-full"));
    const homeLogo = document.getElementById("homeLogo");
    homeLogo.addEventListener("click", (e) => {
      e.preventDefault();
      location.reload();
    });
    let currentFiltered = [];
    let map;
    let markerGroup;
    let globalMap;
    let globalMarkerGroup;
    const categoryIcons = {
      salon: 'fa-scissors',
      spa: 'fa-spa',
      parlour: 'fa-hand-sparkles',
      clinic: 'fa-clinic-medical',
      food: 'fa-burger',
      laundry: 'fa-bath',
      turf: 'fa-futbol',
      gamezone: 'fa-gamepad',
      massage: 'fa-hand-holding-heart',
      event: 'fa-calendar-check',
      petclinic: 'fa-paw',
      dressiron: 'fa-shirt'
    };

    const businessesUrl = new URL("data/businesses.json", window.location.origin);
    fetch(businessesUrl)
      .then(res => res.json())
      .then(data => { businesses = data; });

    searchInput.addEventListener("input", () => {
      const q = searchInput.value.toLowerCase();
      document.querySelectorAll(".category-card").forEach(card => {
        const text = card.querySelector("span.text-lg").textContent.toLowerCase();
        card.classList.toggle("hidden", !text.includes(q));
      });
    });

    function attachRatingListeners() {
      document.querySelectorAll('.rating-star').forEach(el => {
        el.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          showRatings(el.dataset.id);
        });
      });
    }

    function showRatings(id) {
      fetch(`data/${id}.json`)
        .then(r => r.json())
        .then(data => {
          const reviews = data.reviews || [];
          if (reviews.length) {
            ratingPanelContent.innerHTML = reviews.map(rv => {
              const stars = Array.from({ length: 5 })
                .map((_, i) => `<i class="fa-star ${i < rv.rating ? 'fas text-yellow-500 star-glow' : 'far text-gray-300'}"></i>`)
                .join('');
              return `
              <div class="bg-white rounded-lg shadow p-4">
                <div class="flex items-center mb-2">${stars}</div>
                <p class="text-sm text-gray-700 mb-2">${rv.comment}</p>
                <p class="text-xs text-gray-500 text-right">- ${rv.name || rv.author || 'Anonymous'}</p>
              </div>`;
            }).join('');
          } else {
            ratingPanelContent.innerHTML = '<p class="text-gray-500">No ratings available.</p>';
          }
          ratingPanel.classList.remove('translate-x-full');
        })
        .catch(() => {
          ratingPanelContent.innerHTML = '<p class="text-gray-500">No ratings available.</p>';
          ratingPanel.classList.remove('translate-x-full');
        });
    }

    globalMapToggle.addEventListener("click", () => {
      if (globalMapContainer.classList.contains("hidden")) {
        globalMapContainer.classList.remove("hidden");
        categoryGrid.classList.add("hidden");
        globalMapToggle.textContent = "List View";
        if (!globalMap) {
          globalMap = L.map('globalMapContainer').setView([13.0827, 80.2707], 12);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(globalMap);
          globalMarkerGroup = L.layerGroup().addTo(globalMap);
        }
        globalMarkerGroup.clearLayers();
        businesses.forEach(b => {
          if (b.lat && b.lng) {
            const icon = L.divIcon({
              html: `<i class="fa-solid ${categoryIcons[b.category] || 'fa-map-marker'} text-[var(--brand-accent)] text-xl"></i>`,
              className: '',
              iconSize: [24, 24],
              iconAnchor: [12, 12]
            });
            const marker = L.marker([b.lat, b.lng], { icon }).addTo(globalMarkerGroup);
            marker.bindPopup(`<strong>${b.name}</strong><br>${b.address}<br>Rating: ${b.rating}`);
            marker.on('mouseover', function(){ this.openPopup(); });
            marker.on('mouseout', function(){ this.closePopup(); });
            marker.on('click', () => {
              window.location.href = `businessview.html?business=${b.id}`;
            });
          }
        });
        setTimeout(() => globalMap.invalidateSize(), 0);
      } else {
        globalMapContainer.classList.add("hidden");
        categoryGrid.classList.remove("hidden");
        globalMapToggle.textContent = "Map View";
      }
    });

    document.querySelectorAll(".category-card").forEach(card => {
      card.addEventListener("click", () => {
        const category = card.dataset.category;
        const filtered = businesses.filter(b => b.category === category);
        currentFiltered = filtered;
        let html = "";
        for (let i = 0; i < 5; i++) {
          const b = filtered[i];
          if (b) {
            const content = `
              <div class="result-card bg-white rounded-xl overflow-hidden shadow-lg transform transition-all hover:-translate-y-1">
                <div class="h-40 bg-gray-200 flex items-center justify-center">
                  <i class="fa-solid fa-image text-4xl text-gray-400"></i>
                </div>
                <div class="p-6 flex flex-col h-full">
                  <div class="flex justify-between items-start mb-2">
                    <h4 class="text-xl font-semibold">${b.name}</h4>
                    <span class="rating-star flex items-center text-yellow-500 cursor-pointer" data-id="${b.id}"><i class="fa-solid fa-star mr-1 star-glow"></i>${b.rating}</span>
                  </div>
                  <p class="text-gray-600 mb-4 flex-grow">${b.description}</p>
                  <div class="text-sm text-gray-500 mb-4 space-y-1">
                    <p><i class="fa-solid fa-map-marker-alt mr-2"></i>${b.address}</p>
                    <p><i class="fa-solid fa-phone mr-2"></i>${b.phone}</p>
                  </div>
                  ${i < 2 ? '<span class="mt-auto text-[var(--brand-accent)] font-semibold flex items-center">View details<i class="fa-solid fa-arrow-right ml-2"></i></span>' : ''}
                </div>
              </div>`;
            html += i < 2 ? `<a href="businessview.html?business=${b.id}" class="block">${content}</a>` : content;
          } else {
            html += `
              <div class="result-card bg-white rounded-xl overflow-hidden shadow-md flex items-center justify-center text-gray-400 p-6">
                <div class="text-center">
                  <i class="fa-solid fa-store text-4xl mb-2"></i>
                  <p>More businesses coming soon</p>
                </div>
              </div>`;
          }
        }
        resultsContainer.innerHTML = html;
        attachRatingListeners();
        explore.classList.add("lg:flex");
        categoriesSection.classList.add("lg:w-1/3", "lg:pr-8");
        categoryGrid.classList.remove("sm:grid-cols-2", "lg:grid-cols-4");
        categoryGrid.classList.add("grid-cols-1");
        document.querySelectorAll(".category-card").forEach(c => c.classList.add("compact"));
        results.classList.remove("hidden");
        results.classList.add("lg:w-2/3");
        results.scrollIntoView({ behavior: "smooth" });
        document.querySelectorAll(".result-card").forEach((rc, idx) => {
          setTimeout(() => rc.classList.add("show"), idx * 100);
        });
        mapToggle.classList.remove("hidden");
        mapContainer.classList.add("hidden");
        resultsContainer.classList.remove("hidden");
        mapToggle.textContent = "Map View";
      });
    });

    mapToggle.addEventListener("click", () => {
      if (mapContainer.classList.contains("hidden")) {
        mapContainer.classList.remove("hidden");
        resultsContainer.classList.add("hidden");
        mapToggle.textContent = "List View";
        if (!map) {
          map = L.map('mapContainer').setView([13.0827, 80.2707], 12);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(map);
          markerGroup = L.layerGroup().addTo(map);
        }
        markerGroup.clearLayers();
        currentFiltered.forEach(b => {
          if (b.lat && b.lng) {
            const icon = L.divIcon({
              html: `<i class="fa-solid ${categoryIcons[b.category] || 'fa-map-marker'} text-[var(--brand-accent)] text-xl"></i>`,
              className: '',
              iconSize: [24, 24],
              iconAnchor: [12, 12]
            });
            const marker = L.marker([b.lat, b.lng], { icon }).addTo(markerGroup);
            marker.bindPopup(`<strong>${b.name}</strong><br>${b.address}<br>Rating: ${b.rating}`);
            marker.on('mouseover', function(){ this.openPopup(); });
            marker.on('mouseout', function(){ this.closePopup(); });
            marker.on('click', () => {
              window.location.href = `businessview.html?business=${b.id}`;
            });
          }
        });
        setTimeout(() => map.invalidateSize(), 0);
      } else {
        mapContainer.classList.add("hidden");
        resultsContainer.classList.remove("hidden");
        mapToggle.textContent = "Map View";
      }
    });
  </script>
</body>

</html>
